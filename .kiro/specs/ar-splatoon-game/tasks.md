# Implementation Plan

- [ ] 1. プロジェクト基盤とXcodeGen環境の構築
  - [x] 1.1 XcodeGen環境のセットアップ
    - XcodeGenのインストールとMakefileの作成
    - project.ymlファイルの作成（ターゲット、スキーム、設定定義）
    - .gitignoreファイルの設定（.xcodeprojを除外）
    - 開発ツール（SwiftFormat、SwiftLint）の統合
    - _Requirements: 5.1_

  - [x] 1.2 SPMローカルパッケージ構造の構築
    - Domain, Application, Infrastructure, TestSupportパッケージの作成
    - 各パッケージのPackage.swiftファイルと依存関係の定義
    - XcodeGenでのパッケージ統合設定
    - _Requirements: 1.1, 5.1_

  - [ ] 1.3 基本プロジェクト構造の生成
    - `make generate`でXcodeプロジェクトの生成確認
    - SwiftUI基本設定とInfo.plistの設定
    - リソースフォルダ（Assets.xcassets等）の作成
    - _Requirements: 1.1, 5.1_

- [ ] 2. ドメイン層の基盤実装（TDDアプローチ）
  - [ ] 2.1 Value Objectsの実装
    - PlayerId, Position3D, GameScoreのValue Object実装
    - 各Value Objectの不変性とバリデーションロジック
    - Swift Testingを使用したValue Objectsのテスト作成
    - _Requirements: 1.1, 3.1_

  - [ ] 2.2 Entityの実装
    - Player, InkSpot, GameSessionエンティティの実装
    - エンティティの識別子とライフサイクル管理
    - エンティティのテスト作成（テストビルダーパターン使用）
    - _Requirements: 1.1, 3.1, 3.2_

  - [ ] 2.3 ドメインサービスの実装
    - GameRuleService（ゲームルール管理）の実装
    - ScoreCalculationService（スコア計算ロジック）の実装
    - ドメインサービスのテスト作成
    - _Requirements: 4.1, 4.2, 4.3_

- [ ] 3. テスト支援パッケージの構築
  - [ ] 3.1 テストビルダーとモックの実装
    - PlayerBuilder, GameSessionBuilderの実装
    - MockGameRepository, MockPlayerRepositoryの実装
    - テストフィクスチャとテストデータの作成
    - _Requirements: 全要件のテスト支援_

- [ ] 4. アプリケーション層の実装
  - [ ] 4.1 基本ユースケースの実装
    - StartGameUseCaseの実装（ゲーム開始ロジック）
    - ShootInkUseCaseの実装（インク発射ロジック）
    - CalculateScoreUseCaseの実装（スコア計算ロジック）
    - 各ユースケースのテスト作成
    - _Requirements: 3.1, 3.2, 4.1, 4.2_

  - [ ] 4.2 ゲームコーディネーターの実装
    - GameCoordinatorの実装（ゲーム全体の流れ制御）
    - ゲーム状態遷移の管理
    - GameCoordinatorのテスト作成
    - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [ ] 5. インフラストラクチャ層の実装
  - [ ] 5.1 ネットワーク通信の実装
    - MultiPeerGameRepositoryの実装（Multipeer Connectivity統合）
    - NetworkGameMessageの実装（メッセージプロトコル）
    - ネットワーク通信のテスト作成（モック使用）
    - _Requirements: 2.1, 2.2, 2.3, 2.4_

  - [ ] 5.2 データ永続化の実装
    - SwiftDataGameRepositoryの実装（ゲーム履歴保存）
    - SwiftDataモデル（GameHistory, PlayerProfile）の実装
    - データ永続化のテスト作成
    - _Requirements: 4.3, 4.4_

- [ ] 6. プレゼンテーション層の基盤実装
  - [ ] 6.1 SwiftUIビューの基本構造
    - ContentView, MenuView, SettingsViewの実装
    - @Observableマクロを使用した状態管理の実装
    - ナビゲーション構造の構築
    - _Requirements: 5.1, 5.2, 5.3_

  - [ ] 6.2 ゲーム画面のUI実装
    - ARGameViewの基本構造実装
    - ゲーム状態表示UI（スコア、タイマー）の実装
    - ゲーム結果画面（GameResultView）の実装
    - _Requirements: 4.1, 4.2, 4.3, 5.2_

- [ ] 7. AR機能の統合
  - [ ] 7.1 ARKit基盤の実装
    - ARViewControllerの実装（ARセッション管理）
    - ARGameViewRepresentableの実装（SwiftUI-UIKit Bridge）
    - 平面検出とゲームフィールド配置の実装
    - _Requirements: 1.1, 1.2, 1.3_

  - [ ] 7.2 AR描画システムの実装
    - ARInkRendererの実装（インクスポットの3D描画）
    - ARGameFieldRepositoryの実装（AR空間でのゲームフィールド管理）
    - AR座標系とゲーム座標系の変換処理
    - _Requirements: 3.1, 3.2_

- [ ] 8. ゲームロジックとARの統合
  - [ ] 8.1 インク発射システムの統合
    - タップ操作からインク発射への変換処理
    - AR空間でのインク軌道計算と描画
    - インクスポット生成とネットワーク同期
    - _Requirements: 3.1, 3.2_

  - [ ] 8.2 衝突判定システムの実装
    - プレイヤーとインクの衝突判定
    - インクスポット同士の重複処理
    - 衝突時の効果（プレイヤー無効化）の実装
    - _Requirements: 3.3, 3.4_

- [ ] 9. ネットワーク同期の実装
  - [ ] 9.1 リアルタイム同期システム
    - ゲーム状態の同期メッセージ実装
    - インクデータの効率的な送受信
    - 接続切断時の復旧処理
    - _Requirements: 2.1, 2.2, 2.3, 2.4_

  - [ ] 9.2 ゲームセッション管理
    - マルチプレイヤーセッションの開始・終了処理
    - プレイヤー参加・離脱の処理
    - ゲーム同期エラーのハンドリング
    - _Requirements: 2.1, 2.2, 2.4_

- [ ] 10. エラーハンドリングとユーザビリティ
  - [ ] 10.1 エラー処理の実装
    - ARエラー（デバイス非対応、トラッキング失敗）の処理
    - ネットワークエラー（接続失敗、切断）の処理
    - ユーザーフレンドリーなエラーメッセージの表示
    - _Requirements: 1.3, 2.4, 5.4_

  - [ ] 10.2 ユーザビリティの向上
    - ゲーム開始前のチュートリアル実装
    - AR平面検出のガイダンス表示
    - ゲーム中のヘルプとヒント表示
    - _Requirements: 1.3, 5.1, 5.2, 5.3_

- [ ] 11. 統合テストとパフォーマンス最適化
  - [ ] 11.1 統合テストの実装
    - XCUITestを使用したE2Eテストの作成
    - ARとネットワークの統合テスト
    - ゲーム全体のフローテスト
    - _Requirements: 全要件の統合テスト_

  - [ ] 11.2 パフォーマンス最適化
    - AR描画のフレームレート最適化
    - ネットワーク通信の遅延最小化
    - メモリ使用量の最適化とリーク検出
    - _Requirements: 1.1, 2.1, 3.1_

- [ ] 12. 最終調整とポリッシュ
  - [ ] 12.1 ゲームバランス調整
    - インク発射の速度と範囲の調整
    - ゲーム時間とスコア計算の微調整
    - プレイヤーフィードバックに基づく改善
    - _Requirements: 3.1, 3.2, 4.1, 4.2_

  - [ ] 12.2 最終テストとバグ修正
    - 全機能の動作確認テスト
    - エッジケースのテストと修正
    - コードレビューとリファクタリング
    - _Requirements: 全要件の最終確認_
- [
 ] 13. アプリストア準備とコンプライアンス
  - [ ] 13.1 アプリアイコンとアセット作成
    - 各サイズのアプリアイコン作成（1024x1024, 180x180, 120x120等）
    - Launch Screenの作成とダークモード対応
    - アプリ内で使用するアイコンとグラフィック素材の作成
    - XcodeGenでのアセット管理設定の更新
    - _Requirements: 5.1_

  - [ ] 13.2 プライバシーとセキュリティ対応
    - Privacy Manifestファイル（PrivacyInfo.xcprivacy）の作成
    - カメラ使用許可の説明文（NSCameraUsageDescription）の追加
    - ローカルネットワーク使用許可の説明文の追加
    - データ収集・使用に関するプライバシーポリシーの作成
    - _Requirements: 1.1, 2.1_

  - [ ] 13.3 アクセシビリティ対応
    - VoiceOverサポートの実装
    - Dynamic Typeサポートの実装
    - 色覚異常対応（カラーコントラスト調整）
    - スイッチコントロール対応の実装
    - _Requirements: 5.1, 5.2_

- [ ] 14. 多言語対応とローカライゼーション
  - [ ] 14.1 国際化対応の実装
    - Localizable.stringsファイルの作成
    - 日本語・英語の翻訳実装
    - 数値・日付フォーマットの地域対応
    - RTL（右から左）言語対応の準備
    - _Requirements: 5.1, 5.2_

  - [ ] 14.2 地域別機能対応
    - 地域別のゲーム設定調整
    - 文化的配慮事項の確認と対応
    - 各国のレーティング要件の確認
    - _Requirements: 5.1_

- [ ] 15. デバイス対応とパフォーマンス最適化
  - [ ] 15.1 デバイス互換性の確保
    - iPhone各モデル（iPhone 12以降）での動作確認
    - iPad対応の実装（必要に応じて）
    - 異なる画面サイズでのUI調整
    - LiDARセンサー有無での機能差分対応
    - _Requirements: 1.1, 1.2, 5.4_

  - [ ] 15.2 バッテリー効率とパフォーマンス最適化
    - AR処理の電力消費最適化
    - バックグラウンド処理の最小化
    - メモリ使用量の最適化
    - 熱管理とCPU使用率の最適化
    - _Requirements: 1.1, 3.1_

- [ ] 16. 品質保証とテスト
  - [ ] 16.1 包括的テストの実施
    - 各デバイスでの動作テスト
    - 異なるネットワーク環境でのテスト
    - 長時間プレイでの安定性テスト
    - メモリリークとクラッシュテスト
    - _Requirements: 全要件_

  - [ ] 16.2 ベータテストの実施
    - TestFlightでのベータ版配布
    - ベータテスターからのフィードバック収集
    - バグ修正とユーザビリティ改善
    - パフォーマンス問題の特定と修正
    - _Requirements: 全要件_

- [ ] 17. アプリストア申請準備
  - [ ] 17.1 App Store Connectの設定
    - アプリ情報の登録（名前、説明、キーワード）
    - スクリーンショットの作成（各デバイスサイズ）
    - アプリプレビュー動画の作成
    - 年齢レーティングの設定
    - _Requirements: 全要件_

  - [ ] 17.2 申請用ビルドの準備
    - XcodeGenでのリリース設定の最適化
    - リリースビルドの作成とアーカイブ
    - コード署名とプロビジョニングプロファイルの設定
    - App Store Connectへのビルドアップロード
    - 申請用メタデータの最終確認
    - _Requirements: 全要件_

- [ ] 18. 申請とリリース対応
  - [ ] 18.1 App Store審査対応
    - 初回申請の提出
    - 審査チームからの質問・要求への対応
    - 必要に応じた修正版の提出
    - 審査承認後のリリース準備
    - _Requirements: 全要件_

  - [ ] 18.2 リリース後の運用準備
    - クラッシュレポート監視体制の構築
    - ユーザーレビューへの対応準備
    - アップデート計画の策定
    - サポート体制の構築
    - _Requirements: 全要件_

- [ ] 19. マーケティングとプロモーション
  - [ ] 19.1 プロモーション素材の作成
    - プレスリリースの作成
    - SNS用プロモーション動画の作成
    - 開発者ブログ記事の執筆
    - 技術記事の執筆（ARKit活用事例等）
    - _Requirements: 全要件_

  - [ ] 19.2 コミュニティ対応
    - 開発者コミュニティでの発表準備
    - ユーザーコミュニティの構築
    - フィードバック収集システムの構築
    - 今後のアップデート計画の公開
    - _Requirements: 全要件_

- [ ] 20. 継続的改善とメンテナンス
  - [ ] 20.1 分析とモニタリング
    - アプリ使用状況の分析実装
    - クラッシュ率とパフォーマンス監視
    - ユーザーエンゲージメント分析
    - A/Bテスト基盤の構築
    - _Requirements: 全要件_

  - [ ] 20.2 将来の拡張準備
    - 新機能追加のためのアーキテクチャ拡張
    - マルチプレイヤー対応の拡張計画
    - クラウド同期機能の検討
    - 収益化モデルの検討と実装準備
    - _Requirements: 全要件_- [ 
] 21. XcodeGen運用とメンテナンス
  - [ ] 21.1 継続的なプロジェクト管理
    - 新機能追加時のproject.yml更新手順の確立
    - チーム開発でのXcodeGen運用ルールの策定
    - プロジェクト設定変更の履歴管理
    - _Requirements: 全要件_

  - [ ] 21.2 CI/CD統合の最適化
    - GitHub ActionsでのXcodeGen自動実行設定
    - プロジェクト生成エラーの自動検出
    - 設定ファイルの妥当性チェック自動化
    - _Requirements: 全要件_